<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Leave Time Calculator - Keka Punch</title>
<style>
:root{
  --bg:#0f172a;--card:#1e293b;--text:#f8fafc;
  --accent:#3b82f6;--accent-hover:#2563eb;--muted:#94a3b8;
  --green:#22c55e;--red:#ef4444;
}
body{margin:0;padding:24px;font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);display:flex;justify-content:center;}
.card{background:var(--card);border-radius:16px;box-shadow:0 0 20px rgba(0,0,0,0.3);padding:24px;max-width:1000px;width:100%;}
h1{font-size:1.8rem;font-weight:700;margin-bottom:8px;}
p.small{color:var(--muted);font-size:0.9rem;}
textarea{width:100%;height:180px;padding:12px;border-radius:10px;border:none;background:#334155;color:var(--text);font-family:monospace;resize:vertical;}
select,button{border-radius:10px;border:none;padding:10px 16px;font-size:1rem;}
select{background:#334155;color:var(--text);}
button{background:var(--accent);color:white;cursor:pointer;transition:background 0.2s;}
button:hover{background:var(--accent-hover);}
button.ghost{background:#334155;color:var(--text);}
.row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;}
pre{background:#0f172a;color:#e2e8f0;padding:16px;border-radius:10px;overflow:auto;}
.progress-container{background:#334155;border-radius:10px;overflow:hidden;margin-top:12px;height:20px;}
.progress-bar{background:var(--green);height:100%;width:0%;transition:width 0.4s;}
.leave-panel{background:#1e293b;padding:24px;margin-top:20px;text-align:center;border-radius:16px;box-shadow:0 0 15px rgba(0,0,0,0.3);}
.leave-panel h2{font-size:2rem;color:var(--green);}
</style>
</head>
<body>
<div class="card">
<h1>⏱️ Keka Leave Time Calculator</h1>
<p class="small">Paste your punch in/out times below (copy from Keka). Each time in a new line: In → Out. Example:<br>
10:01 AM → 12:01 PM<br>12:03 PM → 01:32 PM</p>
<label>Punch Data</label>
<textarea id="input" placeholder="10:01 AM → 12:01 PM
12:03 PM → 01:32 PM"></textarea>
<div class="row">
<button id="calc">Calculate</button>
<button id="clear" class="ghost">Clear</button>
<button id="copy" class="ghost">Copy Results</button>
</div>
<div class="progress-container">
<div class="progress-bar" id="progress"></div>
</div>
<div class="leave-panel" id="leavePanel" style="display:none;">
<h2 id="leaveTime">Leave at: --:--</h2>
</div>
<h3>Details</h3>
<pre id="summary">Paste punch times and click Calculate.</pre>
</div>

<script>
const pad = n=>n.toString().padStart(2,'0');
const fmt = ms=>{const h=Math.floor(ms/3600000);const m=Math.floor((ms%3600000)/60000);return `${h}h ${pad(m)}m`;};
const parseTimeStr = str=>{
  let m=str.match(/(\d{1,2}):(\d{2})(?::(\d{2}))?\s*([AaPp][Mm])?/);
  if(!m) return null;
  let [_,h,mn,s,ap]=m;h=+h;mn=+mn;s=+(s||0);
  if(ap){ap=ap.toUpperCase();if(ap==='PM'&&h!==12)h+=12;if(ap==='AM'&&h===12)h=0;}
  let d=new Date();d.setHours(h,mn,s,0);return d;
};
document.getElementById('calc').onclick=()=>{
  const input=document.getElementById('input').value.trim();
  if(!input) return;
  const lines=input.split(/\n+/).map(l=>l.trim()).filter(Boolean);
  let pairs=[];
  for(let l of lines){
    let parts=l.split('→').map(x=>x.trim());
    if(parts.length===2){
      const inT=parseTimeStr(parts[0]), outT=parseTimeStr(parts[1]);
      if(inT&&outT)pairs.push([inT,outT]);
    }
  }
  if(pairs.length===0)return;
  let total=0; pairs.forEach(([i,o])=>total+=o-i);
  const target=8*3600000; const remain=Math.max(0,target-total);
  const lastOut=pairs[pairs.length-1][1]; const leaveTime=new Date(lastOut.getTime()+remain);
  document.getElementById('progress').style.width=Math.min(100,(total/target)*100)+'%';
  let out=[];
  pairs.forEach(([i,o],idx)=>out.push(`${idx+1}. ${i.toLocaleTimeString()} → ${o.toLocaleTimeString()} (${fmt(o-i)})`));
  out.push('');out.push(`Total worked: ${fmt(total)}`);out.push(`Remaining to reach 8h: ${fmt(remain)}`);
  document.getElementById('summary').textContent=out.join('\n');
  document.getElementById('leaveTime').textContent='Leave at: '+leaveTime.toLocaleTimeString();
  document.getElementById('leavePanel').style.display='block';
};
document.getElementById('clear').onclick=()=>{
  document.getElementById('input').value='';
  document.getElementById('summary').textContent='Cleared.';
  document.getElementById('progress').style.width='0%';
  document.getElementById('leavePanel').style.display='none';
};
document.getElementById('copy').onclick=()=>{
  navigator.clipboard.writeText(document.getElementById('summary').textContent+"\n"+document.getElementById('leaveTime').textContent);
  alert('Results copied to clipboard!');
};
</script>
</body>
</html>
